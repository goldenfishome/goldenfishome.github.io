<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Time Series for Stock Price in Healthcare - ARIMAX/SARIMAX/VAR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Time Series for Stock Price in Healthcare</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">ARIMAX/SARIMAX/VAR</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dsourse.html" class="sidebar-item-text sidebar-link">Data Sources</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dvis.html" class="sidebar-item-text sidebar-link">Data Visualization</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">EDA</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda.html" class="sidebar-item-text sidebar-link">UNH (Main EDA descriptions)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda_lly.html" class="sidebar-item-text sidebar-link">LLY</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda_azn.html" class="sidebar-item-text sidebar-link">AZN</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda_cvs.html" class="sidebar-item-text sidebar-link">CVS</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda_syk.html" class="sidebar-item-text sidebar-link">SYK</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda_pfe.html" class="sidebar-item-text sidebar-link">PFE</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda_jnj.html" class="sidebar-item-text sidebar-link">JNJ</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./models.html" class="sidebar-item-text sidebar-link">ARMA/ARIMA/SARIMA Models</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arimax.html" class="sidebar-item-text sidebar-link active">ARIMAX/SARIMAX/VAR</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ts.html" class="sidebar-item-text sidebar-link">Financial Time Series Models</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dl.html" class="sidebar-item-text sidebar-link">Deep Learning for TS</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conclusion.html" class="sidebar-item-text sidebar-link">Conclusions</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#arimax" id="toc-arimax" class="nav-link active" data-scroll-target="#arimax">ARIMAX</a>
  <ul class="collapse">
  <li><a href="#step-1-data-prepare" id="toc-step-1-data-prepare" class="nav-link" data-scroll-target="#step-1-data-prepare">Step 1: Data Prepare</a></li>
  <li><a href="#step-2-plotting-the-data" id="toc-step-2-plotting-the-data" class="nav-link" data-scroll-target="#step-2-plotting-the-data">Step 2: Plotting the Data</a></li>
  <li><a href="#step-3-fitting-the-model-using-auto.arima" id="toc-step-3-fitting-the-model-using-auto.arima" class="nav-link" data-scroll-target="#step-3-fitting-the-model-using-auto.arima">Step 3: Fitting the model using ’auto.arima()`</a></li>
  <li><a href="#step-4-fitting-the-model-manually" id="toc-step-4-fitting-the-model-manually" class="nav-link" data-scroll-target="#step-4-fitting-the-model-manually">Step 4: Fitting the model manually</a></li>
  <li><a href="#step-5-using-cross-validation" id="toc-step-5-using-cross-validation" class="nav-link" data-scroll-target="#step-5-using-cross-validation">Step 5: Using Cross Validation</a></li>
  <li><a href="#step-6-forcasting" id="toc-step-6-forcasting" class="nav-link" data-scroll-target="#step-6-forcasting">Step 6: forcasting</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  </ul></li>
  <li><a href="#var" id="toc-var" class="nav-link" data-scroll-target="#var">VAR</a>
  <ul class="collapse">
  <li><a href="#step-1-data-preparing" id="toc-step-1-data-preparing" class="nav-link" data-scroll-target="#step-1-data-preparing">Step 1: Data Preparing</a></li>
  <li><a href="#step-2-plotting-the-data-1" id="toc-step-2-plotting-the-data-1" class="nav-link" data-scroll-target="#step-2-plotting-the-data-1">Step 2: Plotting the data</a></li>
  <li><a href="#step-3-fitting-a-var-model" id="toc-step-3-fitting-a-var-model" class="nav-link" data-scroll-target="#step-3-fitting-a-var-model">Step 3: Fitting a VAR model</a></li>
  <li><a href="#step-4-using-cross-validation" id="toc-step-4-using-cross-validation" class="nav-link" data-scroll-target="#step-4-using-cross-validation">Step 4: Using Cross Validation</a></li>
  <li><a href="#step-5-forecast" id="toc-step-5-forecast" class="nav-link" data-scroll-target="#step-5-forecast">Step 5: Forecast</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">ARIMAX/SARIMAX/VAR</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="arimax" class="level2">
<h2 class="anchored" data-anchor-id="arimax">ARIMAX</h2>
<p>ARIMAX model assumes that future values of a variable linearly depend on its past values, as well as on the values of past (stochastic) shocks. It is an extended version of the ARIMA model, with other independent (predictor) variables. The model is also referred to as the dynamic regression model. The X added to the end stands for “exogenous”. In other words, it suggests adding a separate different outside variable to help measure our endogenous variable.</p>
<p>The ‘exogenous’ variables added here are COVID-19 case numbers and COVID-19 vaccine rates. The number of COVID-19 cases in US can affect healthcare stock prices, e.g.&nbsp;UNH. Higher case numbers may result in increased demand for healthcare services, such as hospitalizations, treatments, and testing, which could positively impact the stock prices of healthcare companies involved in providing those services. Conversely, lower case numbers may lead to reduced demand for healthcare services, potentially resulting in lower stock prices for healthcare companies.</p>
<p>Vaccine rates, specifically the rate at which a population is vaccinated against COVID-19, can also impact healthcare stock prices. Higher vaccine rates are generally seen as positive for healthcare companies, as vaccines are considered a key tool in controlling the spread of the virus and reducing the severity of illness. Higher vaccine rates may lead to decreased demand for COVID-19 treatments and testing, but increased demand for vaccines and other preventive healthcare measures, which could positively impact the stock prices of healthcare companies involved in vaccine production or distribution, as well as other preventive healthcare services.</p>
<p>In this section, we choose the UNH stock price to fit ARIMAX model with COVID-19 case numbers and COVID-19 vaccine rates.</p>
<section id="step-1-data-prepare" class="level3">
<h3 class="anchored" data-anchor-id="step-1-data-prepare">Step 1: Data Prepare</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(<span class="st">"UNH"</span>, <span class="at">from=</span><span class="st">"2020-12-16"</span>, <span class="at">src=</span><span class="st">"yahoo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>UNH_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(UNH)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>UNH_df<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">rownames</span>(UNH_df)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>UNH_df <span class="ot">&lt;-</span> UNH_df[<span class="fu">c</span>(<span class="st">'Date'</span>,<span class="st">'UNH.Adjusted'</span>)]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>UNH_df <span class="ot">&lt;-</span> UNH_df <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date)) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">Date =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Date), <span class="fu">max</span>(Date), <span class="at">by=</span><span class="st">"day"</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># fill missing values in stock </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>UNH_df <span class="ot">&lt;-</span> UNH_df <span class="sc">%&gt;%</span> <span class="fu">fill</span>(UNH.Adjusted)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>new_dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">'2020-12-16'</span>), <span class="fu">as.Date</span>(<span class="st">'2023-3-21'</span>),<span class="st">'week'</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>UNH_df <span class="ot">&lt;-</span> UNH_df[<span class="fu">which</span>((UNH_df<span class="sc">$</span>Date) <span class="sc">%in%</span> new_dates),]</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>vaccine_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'data/vaccine_clean.csv'</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>new_dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">'2020-12-16'</span>), <span class="fu">as.Date</span>(<span class="st">'2023-3-22'</span>),<span class="st">'week'</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#vaccine_df</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>vaccine_df<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(vaccine_df<span class="sc">$</span>Date)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>vaccine_df <span class="ot">&lt;-</span> vaccine_df[<span class="fu">which</span>((vaccine_df<span class="sc">$</span>Date) <span class="sc">%in%</span> new_dates),]</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#covid_df</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>covid_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'data/covid.csv'</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#covid_ts &lt;- ts(covid_df$Weekly.Cases, start = c(2020,1,29), frequency = 54)</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>covid_df<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(covid_df<span class="sc">$</span>Date)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>covid_df <span class="ot">&lt;-</span> covid_df[covid_df<span class="sc">$</span>Date <span class="sc">&gt;=</span> <span class="st">'2020-12-16'</span><span class="sc">&amp;</span>covid_df<span class="sc">$</span>Date <span class="sc">&lt;</span> <span class="st">'2023-03-22'</span>,]</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># combine all data, create dataframe</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(UNH_df, vaccine_df<span class="sc">$</span>total_doses, covid_df<span class="sc">$</span>Weekly.Cases)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Date'</span>, <span class="st">'stock_price'</span>, <span class="st">'vaccine_dose'</span>,<span class="st">'covid_case'</span>)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">Date</th>
<th style="text-align: right;">stock_price</th>
<th style="text-align: right;">vaccine_dose</th>
<th style="text-align: right;">covid_case</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2020-12-16</td>
<td style="text-align: right;">329.2309</td>
<td style="text-align: right;">160010</td>
<td style="text-align: right;">1526464</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020-12-23</td>
<td style="text-align: right;">327.5330</td>
<td style="text-align: right;">577895</td>
<td style="text-align: right;">1499703</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2020-12-30</td>
<td style="text-align: right;">334.7126</td>
<td style="text-align: right;">848447</td>
<td style="text-align: right;">1299023</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-06</td>
<td style="text-align: right;">348.5672</td>
<td style="text-align: right;">1029958</td>
<td style="text-align: right;">1584212</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2021-01-13</td>
<td style="text-align: right;">344.4632</td>
<td style="text-align: right;">1334188</td>
<td style="text-align: right;">1716354</td>
</tr>
<tr class="even">
<td style="text-align: left;">2021-01-20</td>
<td style="text-align: right;">340.3883</td>
<td style="text-align: right;">1614134</td>
<td style="text-align: right;">1391546</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="step-2-plotting-the-data" class="level3">
<h3 class="anchored" data-anchor-id="step-2-plotting-the-data">Step 2: Plotting the Data</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(df,<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-16"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">52</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(df.ts[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)], <span class="at">facets=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Variables influencing UNH Stock Price in USA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>UNH stock price, Covid, Vaccine values</p>
</section>
<section id="step-3-fitting-the-model-using-auto.arima" class="level3">
<h3 class="anchored" data-anchor-id="step-3-fitting-the-model-using-auto.arima">Step 3: Fitting the model using ’auto.arima()`</h3>
<p>Here I’m using auto.arima() function to fit the ARIMAX model. Here we are trying to predict UNH stock price using COVID vaccine dose and COVID cases. All variables are time series and the exogenous variables in this case are vaccine_dose and covid_case.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>xreg <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">Vac =</span> df.ts[, <span class="st">"vaccine_dose"</span>],</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">Imp =</span> df.ts[, <span class="st">"covid_case"</span>])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(df.ts[, <span class="st">"stock_price"</span>], <span class="at">xreg =</span> xreg)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: df.ts[, "stock_price"] 
Regression with ARIMA(0,1,0) errors 

Coefficients:
        Vac    Imp
      0e+00  0e+00
s.e.  1e-04  1e-04

sigma^2 = 177.9:  log likelihood = -468.1
AIC=942.2   AICc=942.41   BIC=950.49

Training set error measures:
                   ME     RMSE      MAE      MPE     MAPE      MASE       ACF1
Training set 1.097616 13.16639 10.30662 0.233993 2.273228 0.1046469 0.04011524</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from Regression with ARIMA(0,1,0) errors
Q* = 21.112, df = 24, p-value = 0.6321

Model df: 0.   Total lags used: 24</code></pre>
</div>
</div>
<p>This is an ARIMA model. This is a Regression model with ARIMA(0,1,0) errors.</p>
</section>
<section id="step-4-fitting-the-model-manually" class="level3">
<h3 class="anchored" data-anchor-id="step-4-fitting-the-model-manually">Step 4: Fitting the model manually</h3>
<p>Here we will first have to fit the linear regression model predicting stock price using Covid cases and vaccine doses.</p>
<p>Then for the residuals, we will fit an ARIMA/SARIMA model.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>stock_price <span class="ot">&lt;-</span> <span class="fu">ts</span>(df<span class="sc">$</span>stock_price,<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-16"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">52</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>vaccine_dose <span class="ot">&lt;-</span><span class="fu">ts</span>(df<span class="sc">$</span>vaccine_dose,<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-16"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">52</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>covid_case<span class="ot">&lt;-</span><span class="fu">ts</span>(df<span class="sc">$</span>covid_case,<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-16"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">52</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">######### First fit the linear model#######</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>fit.reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(stock_price <span class="sc">~</span> vaccine_dose<span class="sc">+</span>covid_case, <span class="at">data=</span>df)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = stock_price ~ vaccine_dose + covid_case, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-154.24  -42.59    8.62   42.91   82.36 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   4.954e+02  7.932e+00  62.461  &lt; 2e-16 ***
vaccine_dose -4.341e-05  5.043e-06  -8.607 4.47e-14 ***
covid_case   -3.275e-06  5.345e-06  -0.613    0.541    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 52.02 on 115 degrees of freedom
Multiple R-squared:  0.3944,    Adjusted R-squared:  0.3839 
F-statistic: 37.45 on 2 and 115 DF,  p-value: 2.988e-13</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>res.fit<span class="ot">&lt;-</span><span class="fu">ts</span>(<span class="fu">residuals</span>(fit.reg),<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-16"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">52</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="do">########## Then look at the residuals ########</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(res.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Pacf</span>(res.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>res.fit <span class="sc">%&gt;%</span> <span class="fu">diff</span>() <span class="sc">%&gt;%</span> <span class="fu">ggtsdisplay</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>res.fit <span class="sc">%&gt;%</span> <span class="fu">diff</span>() <span class="sc">%&gt;%</span> <span class="fu">diff</span>(<span class="dv">52</span>) <span class="sc">%&gt;%</span> <span class="fu">ggtsdisplay</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finding the model parameters.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>d<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>ls<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">6</span><span class="sc">*</span><span class="dv">23</span>),<span class="at">nrow=</span><span class="dv">23</span>) <span class="co"># roughly nrow = 3x4x2</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)<span class="co"># p=1,2,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)<span class="co"># q=1,2,</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(d <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)<span class="co"># </span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p<span class="dv">-1</span><span class="sc">+</span>d<span class="sc">+</span>q<span class="dv">-1</span><span class="sc">&lt;=</span><span class="dv">8</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        model<span class="ot">&lt;-</span> <span class="fu">Arima</span>(res.fit,<span class="at">order=</span><span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>),<span class="at">include.drift=</span><span class="cn">TRUE</span>) </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        ls[i,]<span class="ot">=</span> <span class="fu">c</span>(p<span class="dv">-1</span>,d,q<span class="dv">-1</span>,model<span class="sc">$</span>aic,model<span class="sc">$</span>bic,model<span class="sc">$</span>aicc)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>        i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(i)</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">=</span> <span class="fu">as.data.frame</span>(ls)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"d"</span>,<span class="st">"q"</span>,<span class="st">"AIC"</span>,<span class="st">"BIC"</span>,<span class="st">"AICc"</span>)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">#temp</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">p</th>
<th style="text-align: right;">d</th>
<th style="text-align: right;">q</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">AICc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1217.4187</td>
<td style="text-align: right;">1225.7307</td>
<td style="text-align: right;">1217.6292</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">993.5902</td>
<td style="text-align: right;">999.1146</td>
<td style="text-align: right;">993.6955</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1117.7725</td>
<td style="text-align: right;">1128.8552</td>
<td style="text-align: right;">1118.1264</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">993.1256</td>
<td style="text-align: right;">1001.4121</td>
<td style="text-align: right;">993.3380</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1058.3969</td>
<td style="text-align: right;">1072.2503</td>
<td style="text-align: right;">1058.9326</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">994.2046</td>
<td style="text-align: right;">1005.2533</td>
<td style="text-align: right;">994.5617</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1005.4074</td>
<td style="text-align: right;">1016.4901</td>
<td style="text-align: right;">1005.7614</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">992.7214</td>
<td style="text-align: right;">1001.0079</td>
<td style="text-align: right;">992.9338</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1003.8974</td>
<td style="text-align: right;">1017.7508</td>
<td style="text-align: right;">1004.4331</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">994.2405</td>
<td style="text-align: right;">1005.2892</td>
<td style="text-align: right;">994.5976</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1003.9563</td>
<td style="text-align: right;">1020.5804</td>
<td style="text-align: right;">1004.7130</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">995.7980</td>
<td style="text-align: right;">1009.6089</td>
<td style="text-align: right;">996.3386</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1002.8800</td>
<td style="text-align: right;">1016.7334</td>
<td style="text-align: right;">1003.4157</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">994.1790</td>
<td style="text-align: right;">1005.2277</td>
<td style="text-align: right;">994.5362</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">999.6163</td>
<td style="text-align: right;">1016.2404</td>
<td style="text-align: right;">1000.3730</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">995.8971</td>
<td style="text-align: right;">1009.7080</td>
<td style="text-align: right;">996.4376</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1005.7699</td>
<td style="text-align: right;">1025.1647</td>
<td style="text-align: right;">1006.7881</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">995.6381</td>
<td style="text-align: right;">1012.2111</td>
<td style="text-align: right;">996.4017</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Minimum AIC'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Minimum AIC"</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>temp[<span class="fu">which.min</span>(temp<span class="sc">$</span>AIC),] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q      AIC      BIC     AICc
8 1 1 0 992.7214 1001.008 992.9338</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Minimum BIC'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Minimum BIC"</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>temp[<span class="fu">which.min</span>(temp<span class="sc">$</span>BIC),] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q      AIC      BIC     AICc
2 0 1 0 993.5902 999.1146 993.6955</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Minimum AICc'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Minimum AICc"</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>temp[<span class="fu">which.min</span>(temp<span class="sc">$</span>AICc),] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q      AIC      BIC     AICc
8 1 1 0 992.7214 1001.008 992.9338</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>model_output12 <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">sarima</span>(res.fit, <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(model_output12[<span class="dv">9</span><span class="sc">:</span><span class="dv">38</span>], model_output12[<span class="fu">length</span>(model_output12)], <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$fit

Call:
arima(x = xdata, order = c(p, d, q), seasonal = list(order = c(P, D, Q), period = S), 
    xreg = constant, transform.pars = trans, fixed = fixed, optim.control = list(trace = trc, 
        REPORT = 1, reltol = tol))

Coefficients:
      constant
        1.0885
s.e.    1.5357

sigma^2 estimated as 275.9:  log likelihood = -494.8,  aic = 993.59

$degrees_of_freedom
[1] 116

$ttable
         Estimate     SE t.value p.value
constant   1.0885 1.5357  0.7088  0.4799

$AIC
[1] 8.492224

$AICc
[1] 8.492522

$BIC
[1] 8.539441</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>model_output13 <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">sarima</span>(res.fit, <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(model_output13[<span class="dv">16</span><span class="sc">:</span><span class="dv">46</span>], model_output13[<span class="fu">length</span>(model_output13)], <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$fit

Call:
arima(x = xdata, order = c(p, d, q), seasonal = list(order = c(P, D, Q), period = S), 
    xreg = constant, transform.pars = trans, fixed = fixed, optim.control = list(trace = trc, 
        REPORT = 1, reltol = tol))

Coefficients:
         ar1  constant
      0.1556    1.1047
s.e.  0.0913    1.7935

sigma^2 estimated as 269.2:  log likelihood = -493.36,  aic = 992.72

$degrees_of_freedom
[1] 115

$ttable
         Estimate     SE t.value p.value
ar1        0.1556 0.0913  1.7049  0.0909
constant   1.1047 1.7935  0.6160  0.5391

$AIC
[1] 8.484798

$AICc
[1] 8.485698

$BIC
[1] 8.555623</code></pre>
</div>
</div>
<p>ARIMA(0,1,0) and ARIMA(1,1,0) both look okay.</p>
</section>
<section id="step-5-using-cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="step-5-using-cross-validation">Step 5: Using Cross Validation</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">36</span> <span class="co"># minimum data length for fitting a model </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(res.fit)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>n<span class="sc">-</span>k <span class="co"># rest of the observations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 82</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>err1 <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>err2 <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>rmse1 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>rmse2 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">-</span>k))</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  xtrain <span class="ot">&lt;-</span> res.fit[<span class="dv">1</span><span class="sc">:</span>(k<span class="dv">-1</span>)<span class="sc">+</span>i] <span class="co">#observations from 1 to 75</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  xtest <span class="ot">&lt;-</span> res.fit[k<span class="sc">+</span>i] <span class="co">#76th observation as the test set</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(xtrain, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="at">include.drift=</span><span class="cn">FALSE</span>, <span class="at">method=</span><span class="st">"ML"</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  fcast1 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h=</span><span class="dv">1</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  fit2 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(xtrain, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="at">include.drift=</span><span class="cn">FALSE</span>, <span class="at">method=</span><span class="st">"ML"</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  fcast2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit2, <span class="at">h=</span><span class="dv">1</span>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#capture error for each iteration</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is mean absolute error</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  err1 <span class="ot">=</span> <span class="fu">c</span>(err1, <span class="fu">abs</span>(fcast1<span class="sc">$</span>mean<span class="sc">-</span>xtest)) </span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  err2 <span class="ot">=</span> <span class="fu">c</span>(err2, <span class="fu">abs</span>(fcast2<span class="sc">$</span>mean<span class="sc">-</span>xtest))</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is mean squared error</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  err3 <span class="ot">=</span> <span class="fu">c</span>(err1, (fcast1<span class="sc">$</span>mean<span class="sc">-</span>xtest)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  err4 <span class="ot">=</span> <span class="fu">c</span>(err2, (fcast2<span class="sc">$</span>mean<span class="sc">-</span>xtest)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  rmse1 <span class="ot">&lt;-</span> <span class="fu">c</span>(rmse1, <span class="fu">sqrt</span>((fcast1<span class="sc">$</span>mean<span class="sc">-</span>xtest)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  rmse2 <span class="ot">&lt;-</span> <span class="fu">c</span>(rmse2, <span class="fu">sqrt</span>((fcast2<span class="sc">$</span>mean<span class="sc">-</span>xtest)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>(<span class="at">MAE1=</span><span class="fu">mean</span>(err1)) <span class="co"># This is mean absolute error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.45554</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">MAE2=</span><span class="fu">mean</span>(err2)) <span class="co">#has slightly higher error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.46804</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>MSE1<span class="ot">=</span><span class="fu">mean</span>(err1) <span class="co">#fit 1,1,0</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>MSE2<span class="ot">=</span><span class="fu">mean</span>(err2)<span class="co">#fit 0,1,0</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>MSE1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.45554</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>MSE2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.46804</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rmse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rmse1,rmse2)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>rmse_df<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(rmse_df))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmse_df<span class="sc">$</span>x, rmse_df<span class="sc">$</span>rmse1, <span class="at">type =</span> <span class="st">'l'</span>, <span class="at">col=</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="st">"horizon"</span>, <span class="at">ylab=</span><span class="st">"RMSE"</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(rmse_df<span class="sc">$</span>x, rmse_df<span class="sc">$</span>rmse2, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">col=</span><span class="dv">3</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>,<span class="at">legend=</span><span class="fu">c</span>(<span class="st">"fit1"</span>,<span class="st">"fit2"</span>),<span class="at">col=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>,<span class="at">lty=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="step-6-forcasting" class="level3">
<h3 class="anchored" data-anchor-id="step-6-forcasting">Step 6: forcasting</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>vac_fit<span class="ot">&lt;-</span><span class="fu">auto.arima</span>(df<span class="sc">$</span>vaccine_dose) <span class="co">#fiting an ARIMA model to the vaccine_dose variable</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(vac_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: df$vaccine_dose 
ARIMA(1,1,1) 

Coefficients:
         ar1      ma1
      0.8341  -0.6298
s.e.  0.0916   0.1128

sigma^2 = 4.824e+10:  log likelihood = -1604.18
AIC=3214.36   AICc=3214.57   BIC=3222.65

Training set error measures:
                    ME     RMSE      MAE          MPE     MAPE      MASE
Training set -1592.486 216829.1 132002.8 0.0009291879 13.08388 0.1149613
                    ACF1
Training set -0.06829849</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fvac<span class="ot">&lt;-</span><span class="fu">forecast</span>(vac_fit)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>covid_fit<span class="ot">&lt;-</span><span class="fu">auto.arima</span>(df<span class="sc">$</span>covid_case) <span class="co">#fiting an ARIMA model to the covid_case variable</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(covid_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: df$covid_case 
ARIMA(2,0,2) with non-zero mean 

Coefficients:
         ar1      ar2     ma1     ma2      mean
      1.3306  -0.5128  0.8165  0.4848  733469.2
s.e.  0.1153   0.1117  0.1363  0.1076  189902.4

sigma^2 = 2.904e+10:  log likelihood = -1588.94
AIC=3189.87   AICc=3190.63   BIC=3206.5

Training set error measures:
                    ME     RMSE      MAE       MPE     MAPE      MASE
Training set -424.0988 166757.6 99191.78 -6.959882 17.02194 0.1095754
                    ACF1
Training set -0.00122146</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fcov<span class="ot">&lt;-</span><span class="fu">forecast</span>(covid_fit)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>fxreg <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">Vac =</span> fvac<span class="sc">$</span>mean,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">Cov =</span> fcov<span class="sc">$</span>mean)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">xreg=</span>fxreg) <span class="co">#fimp$mean gives the forecasted values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in forecast.forecast_ARIMA(fit, xreg = fxreg): xreg not required by this
model, ignoring the provided regressors</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fcast) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="discussion" class="level3">
<h3 class="anchored" data-anchor-id="discussion">Discussion</h3>
<p>Based on the result above, the number of daily COVID-19 vaccination number is not significant on predicting the UNH stock price, while the number of COVID-19 cases is. Though the number of COVID-19 vaccination number is not significant here, it does not mean that it does not affect healthcare stock price. While UNH is a healthcare company that is involved in health insurance, healthcare services, and technology solutions, it is not directly involved in COVID-19 vaccine development or production. Therefore, the number of COVID-19 vaccine doses administered may not have a direct impact on UNH’s operations or revenue.</p>
</section>
</section>
<section id="var" class="level2">
<h2 class="anchored" data-anchor-id="var">VAR</h2>
<p>VAR models (vector autoregressive models) are used for multivariate time series. The structure is that each variable is a linear function of past lags of itself and past lags of the other variables. A Vector autoregressive (VAR) model is useful when one is interested in predicting multiple time series variables using a single model.</p>
<p>The variables we are interested here are GDP and Unemployment rate in US. The overall health of the economy, as reflected by the GDP, can influence healthcare stock prices. A strong GDP generally indicates a healthy economy with higher levels of consumer spending, business investment, and economic growth. In such an environment, healthcare companies may experience increased demand for their products and services, which could positively impact their stock prices. Conversely, a weak GDP may signal an economic slowdown or recession, which could result in reduced demand for healthcare products and services, potentially leading to lower stock prices for healthcare companies. The unemployment rate, which reflects the percentage of the labor force that is unemployed, can also affect healthcare stock prices. A low unemployment rate is generally indicative of a strong labor market, with more people employed and potentially having access to employer-sponsored healthcare benefits. This may result in increased demand for healthcare services, positively impacting healthcare stock prices. On the other hand, a high unemployment rate may indicate a weak labor market, with more people losing their jobs and potentially losing access to healthcare benefits, leading to reduced demand for healthcare services and potentially lower stock prices for healthcare companies.</p>
<p>In this section, I’m fitting a VAR model to find multivariate relationship between the series UNH stock price, GDP, and Employment.</p>
<section id="step-1-data-preparing" class="level3">
<h3 class="anchored" data-anchor-id="step-1-data-preparing">Step 1: Data Preparing</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(<span class="st">"UNH"</span>, <span class="at">from=</span><span class="st">"1989-12-29"</span>, <span class="at">src=</span><span class="st">"yahoo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "UNH"</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>UNH_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(UNH)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>UNH_df<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">rownames</span>(UNH_df)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>UNH_df <span class="ot">&lt;-</span> UNH_df[<span class="fu">c</span>(<span class="st">'Date'</span>,<span class="st">'UNH.Adjusted'</span>)]</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>UNH_df <span class="ot">&lt;-</span> UNH_df <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date)) <span class="sc">%&gt;%</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">Date =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(Date), <span class="fu">max</span>(Date), <span class="at">by=</span><span class="st">"day"</span>))</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co"># fill missing values in stock </span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>UNH_df <span class="ot">&lt;-</span> UNH_df <span class="sc">%&gt;%</span> <span class="fu">fill</span>(UNH.Adjusted)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">#UNH_df</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>new_dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">'1990-01-01'</span>), <span class="fu">as.Date</span>(<span class="st">'2022-10-01'</span>),<span class="st">'quarter'</span>)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">#new_dates</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>UNH_df <span class="ot">&lt;-</span> UNH_df[<span class="fu">which</span>((UNH_df<span class="sc">$</span>Date) <span class="sc">%in%</span> new_dates),]</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>gdp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'data/GDP59.CSV'</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>gdp<span class="sc">$</span>DATE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(gdp<span class="sc">$</span>DATE)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>gdp <span class="ot">&lt;-</span> gdp[<span class="fu">which</span>((gdp<span class="sc">$</span>DATE) <span class="sc">%in%</span> new_dates),]</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>emp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'data/Employment59.CSV'</span>)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>emp<span class="sc">$</span>DATE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(emp<span class="sc">$</span>DATE)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>emp <span class="ot">&lt;-</span> emp[<span class="fu">which</span>((emp<span class="sc">$</span>DATE) <span class="sc">%in%</span> new_dates),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(UNH_df,gdp,emp)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> dd[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>)]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dd) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'DATE'</span>, <span class="st">'stock_price'</span>,<span class="st">'GDP'</span>,<span class="st">'Employment'</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(dd))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">DATE</th>
<th style="text-align: right;">stock_price</th>
<th style="text-align: right;">GDP</th>
<th style="text-align: right;">Employment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">125</td>
<td style="text-align: left;">1990-01-01</td>
<td style="text-align: right;">0.308110</td>
<td style="text-align: right;">5872.701</td>
<td style="text-align: right;">109418.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">126</td>
<td style="text-align: left;">1990-04-01</td>
<td style="text-align: right;">0.247759</td>
<td style="text-align: right;">5960.028</td>
<td style="text-align: right;">109786.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">127</td>
<td style="text-align: left;">1990-07-01</td>
<td style="text-align: right;">0.438343</td>
<td style="text-align: right;">6015.116</td>
<td style="text-align: right;">109651.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">128</td>
<td style="text-align: left;">1990-10-01</td>
<td style="text-align: right;">0.435356</td>
<td style="text-align: right;">6004.733</td>
<td style="text-align: right;">109255.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">129</td>
<td style="text-align: left;">1991-01-01</td>
<td style="text-align: right;">0.591069</td>
<td style="text-align: right;">6035.178</td>
<td style="text-align: right;">108783.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">130</td>
<td style="text-align: left;">1991-04-01</td>
<td style="text-align: right;">0.985114</td>
<td style="text-align: right;">6126.862</td>
<td style="text-align: right;">108312.3</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="step-2-plotting-the-data-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-plotting-the-data-1">Step 2: Plotting the data</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>dd.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(dd,<span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"1990-01-01"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(dd.ts[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)], <span class="at">facets=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"UNH Stock Price, GDP and Employment in USA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="step-3-fitting-a-var-model" class="level3">
<h3 class="anchored" data-anchor-id="step-3-fitting-a-var-model">Step 3: Fitting a VAR model</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VARselect</span>(dd[, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)], <span class="at">lag.max=</span><span class="dv">10</span>, <span class="at">type=</span><span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$selection
AIC(n)  HQ(n)  SC(n) FPE(n) 
    10      9      9      9 

$criteria
                  1            2            3            4            5
AIC(n) 2.941404e+01 2.865601e+01 2.849637e+01 2.814189e+01 2.812288e+01
HQ(n)  2.955407e+01 2.888005e+01 2.880444e+01 2.853398e+01 2.859898e+01
SC(n)  2.975880e+01 2.920762e+01 2.925484e+01 2.910721e+01 2.929506e+01
FPE(n) 5.948597e+12 2.788633e+12 2.379347e+12 1.671830e+12 1.644336e+12
                  6            7            8            9           10
AIC(n) 2.758294e+01 2.723307e+01 2.696700e+01 2.669062e+01 2.668670e+01
HQ(n)  2.814305e+01 2.787720e+01 2.769516e+01 2.750279e+01 2.758289e+01
SC(n)  2.896196e+01 2.881895e+01 2.875974e+01 2.869021e+01 2.889314e+01
FPE(n) 9.616264e+11 6.809549e+11 5.251270e+11 4.014819e+11 4.038690e+11</code></pre>
</div>
</div>
<p>It’s clear that according to selection criteria p=10 and 9 are good.</p>
<p>I’m fitting several models with p=1(for simplicity), 5, and 9.=&gt; VAR(1), VAR(5), VAR(9)</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">VAR</span>(dd[, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)], <span class="at">p=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">'both'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: stock_price, GDP, Employment 
Deterministic variables: both 
Sample size: 131 
Log Likelihood: -2461.36 
Roots of the characteristic polynomial:
1.028 0.9422  0.78
Call:
VAR(y = dd[, c(2:4)], p = 1, type = "both")


Estimation results for equation stock_price: 
============================================ 
stock_price = stock_price.l1 + GDP.l1 + Employment.l1 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
stock_price.l1  1.0341243  0.0394781  26.195   &lt;2e-16 ***
GDP.l1         -0.0005115  0.0039797  -0.129   0.8979    
Employment.l1  -0.0006163  0.0003038  -2.029   0.0446 *  
const          69.2145818 34.7475964   1.992   0.0485 *  
trend           0.3006699  0.4555344   0.660   0.5104    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 14.62 on 126 degrees of freedom
Multiple R-Squared: 0.9849, Adjusted R-squared: 0.9844 
F-statistic:  2057 on 4 and 126 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation GDP: 
==================================== 
GDP = stock_price.l1 + GDP.l1 + Employment.l1 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
stock_price.l1    2.55503    0.64584   3.956 0.000126 ***
GDP.l1            0.79020    0.06511  12.137  &lt; 2e-16 ***
Employment.l1    -0.01069    0.00497  -2.151 0.033349 *  
const          2355.16290  568.45522   4.143 6.24e-05 ***
trend            27.89290    7.45234   3.743 0.000275 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 239.2 on 126 degrees of freedom
Multiple R-Squared: 0.998,  Adjusted R-squared: 0.998 
F-statistic: 1.607e+04 on 4 and 126 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation Employment: 
=========================================== 
Employment = stock_price.l1 + GDP.l1 + Employment.l1 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
stock_price.l1  6.183e+00  4.862e+00   1.272  0.20584    
GDP.l1         -5.610e-01  4.901e-01  -1.145  0.25458    
Employment.l1   9.253e-01  3.741e-02  24.733  &lt; 2e-16 ***
const           1.161e+04  4.279e+03   2.712  0.00762 ** 
trend           8.544e+01  5.610e+01   1.523  0.13028    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 1801 on 126 degrees of freedom
Multiple R-Squared: 0.9786, Adjusted R-squared: 0.9779 
F-statistic:  1441 on 4 and 126 DF,  p-value: &lt; 2.2e-16 



Covariance matrix of residuals:
            stock_price    GDP Employment
stock_price       213.8   1386      12148
GDP              1385.8  57224     396720
Employment      12147.6 396720    3242998

Correlation matrix of residuals:
            stock_price    GDP Employment
stock_price      1.0000 0.3962     0.4613
GDP              0.3962 1.0000     0.9209
Employment       0.4613 0.9209     1.0000</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">VAR</span>(dd[, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)], <span class="at">p=</span><span class="dv">5</span>, <span class="at">type=</span><span class="st">'both'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: stock_price, GDP, Employment 
Deterministic variables: both 
Sample size: 127 
Log Likelihood: -2267.863 
Roots of the characteristic polynomial:
1.054 0.9435 0.9435 0.8781 0.8781 0.7952 0.7952 0.7806 0.7806 0.7709 0.7709 0.6959 0.4107 0.4107 0.3355
Call:
VAR(y = dd[, c(2:4)], p = 5, type = "both")


Estimation results for equation stock_price: 
============================================ 
stock_price = stock_price.l1 + GDP.l1 + Employment.l1 + stock_price.l2 + GDP.l2 + Employment.l2 + stock_price.l3 + GDP.l3 + Employment.l3 + stock_price.l4 + GDP.l4 + Employment.l4 + stock_price.l5 + GDP.l5 + Employment.l5 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
stock_price.l1  5.454e-01  1.048e-01   5.204 9.13e-07 ***
GDP.l1          6.007e-02  1.789e-02   3.358  0.00108 ** 
Employment.l1  -7.709e-03  2.385e-03  -3.232  0.00162 ** 
stock_price.l2  2.323e-01  1.468e-01   1.583  0.11639    
GDP.l2         -6.188e-02  2.695e-02  -2.297  0.02353 *  
Employment.l2   8.708e-03  4.117e-03   2.115  0.03668 *  
stock_price.l3 -6.701e-02  1.636e-01  -0.410  0.68293    
GDP.l3          1.256e-02  2.614e-02   0.480  0.63198    
Employment.l3  -3.778e-03  4.122e-03  -0.917  0.36136    
stock_price.l4  2.159e-01  1.796e-01   1.202  0.23192    
GDP.l4         -1.114e-02  2.275e-02  -0.490  0.62525    
Employment.l4   2.759e-03  3.733e-03   0.739  0.46146    
stock_price.l5  2.480e-01  1.956e-01   1.268  0.20751    
GDP.l5         -1.060e-02  1.379e-02  -0.769  0.44375    
Employment.l5  -6.394e-04  2.197e-03  -0.291  0.77155    
const           1.189e+02  3.723e+01   3.194  0.00183 ** 
trend           1.493e+00  5.610e-01   2.661  0.00897 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 12.06 on 110 degrees of freedom
Multiple R-Squared: 0.9909, Adjusted R-squared: 0.9896 
F-statistic: 750.5 on 16 and 110 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation GDP: 
==================================== 
GDP = stock_price.l1 + GDP.l1 + Employment.l1 + stock_price.l2 + GDP.l2 + Employment.l2 + stock_price.l3 + GDP.l3 + Employment.l3 + stock_price.l4 + GDP.l4 + Employment.l4 + stock_price.l5 + GDP.l5 + Employment.l5 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
stock_price.l1   -1.30445    1.54245  -0.846 0.399555    
GDP.l1            1.92765    0.26327   7.322 4.28e-11 ***
Employment.l1    -0.18525    0.03510  -5.277 6.65e-07 ***
stock_price.l2    7.85075    2.15990   3.635 0.000425 ***
GDP.l2           -0.49800    0.39656  -1.256 0.211852    
Employment.l2     0.14315    0.06059   2.363 0.019907 *  
stock_price.l3    1.97665    2.40806   0.821 0.413510    
GDP.l3           -0.68441    0.38474  -1.779 0.078023 .  
Employment.l3     0.07846    0.06066   1.293 0.198571    
stock_price.l4   -3.50097    2.64351  -1.324 0.188127    
GDP.l4           -0.53338    0.33481  -1.593 0.114012    
Employment.l4     0.03338    0.05493   0.608 0.544643    
stock_price.l5   -4.52830    2.87918  -1.573 0.118643    
GDP.l5            0.62554    0.20300   3.081 0.002603 ** 
Employment.l5    -0.07633    0.03233  -2.361 0.019978 *  
const          1593.63764  547.91857   2.909 0.004394 ** 
trend            21.22796    8.25642   2.571 0.011473 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 177.5 on 110 degrees of freedom
Multiple R-Squared: 0.999,  Adjusted R-squared: 0.9988 
F-statistic:  6815 on 16 and 110 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation Employment: 
=========================================== 
Employment = stock_price.l1 + GDP.l1 + Employment.l1 + stock_price.l2 + GDP.l2 + Employment.l2 + stock_price.l3 + GDP.l3 + Employment.l3 + stock_price.l4 + GDP.l4 + Employment.l4 + stock_price.l5 + GDP.l5 + Employment.l5 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
stock_price.l1 -3.786e+01  1.190e+01  -3.182  0.00190 ** 
GDP.l1          6.787e+00  2.030e+00   3.343  0.00113 ** 
Employment.l1  -1.385e-02  2.707e-01  -0.051  0.95928    
stock_price.l2  7.770e+01  1.666e+01   4.664 8.77e-06 ***
GDP.l2         -2.705e+00  3.058e+00  -0.885  0.37831    
Employment.l2   6.207e-01  4.673e-01   1.328  0.18686    
stock_price.l3  4.014e+00  1.857e+01   0.216  0.82927    
GDP.l3         -8.103e+00  2.967e+00  -2.731  0.00736 ** 
Employment.l3   1.098e+00  4.678e-01   2.346  0.02075 *  
stock_price.l4 -1.641e+01  2.039e+01  -0.805  0.42269    
GDP.l4         -1.499e+00  2.582e+00  -0.581  0.56270    
Employment.l4  -1.900e-01  4.237e-01  -0.448  0.65470    
stock_price.l5 -2.700e+01  2.221e+01  -1.216  0.22657    
GDP.l5          4.674e+00  1.566e+00   2.985  0.00349 ** 
Employment.l5  -5.865e-01  2.493e-01  -2.352  0.02044 *  
const           1.222e+04  4.226e+03   2.891  0.00462 ** 
trend           1.203e+02  6.368e+01   1.890  0.06146 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 1369 on 110 degrees of freedom
Multiple R-Squared: 0.9879, Adjusted R-squared: 0.9861 
F-statistic: 560.4 on 16 and 110 DF,  p-value: &lt; 2.2e-16 



Covariance matrix of residuals:
            stock_price      GDP Employment
stock_price       145.5    455.4       5503
GDP               455.4  31506.6     225145
Employment       5503.3 225144.8    1874014

Correlation matrix of residuals:
            stock_price    GDP Employment
stock_price      1.0000 0.2127     0.3333
GDP              0.2127 1.0000     0.9266
Employment       0.3333 0.9266     1.0000</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">VAR</span>(dd[, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)], <span class="at">p=</span><span class="dv">9</span>, <span class="at">type=</span><span class="st">'both'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
VAR Estimation Results:
========================= 
Endogenous variables: stock_price, GDP, Employment 
Deterministic variables: both 
Sample size: 123 
Log Likelihood: -2076.371 
Roots of the characteristic polynomial:
1.058 1.051 1.018 1.018 1.012 1.012 1.012 1.012 1.005 1.005 1.003 1.003 0.9793 0.9793 0.9726 0.9726 0.8256 0.8256 0.8098 0.8098 0.7926 0.7926 0.6662 0.6662 0.4868 0.4868 0.0237
Call:
VAR(y = dd[, c(2:4)], p = 9, type = "both")


Estimation results for equation stock_price: 
============================================ 
stock_price = stock_price.l1 + GDP.l1 + Employment.l1 + stock_price.l2 + GDP.l2 + Employment.l2 + stock_price.l3 + GDP.l3 + Employment.l3 + stock_price.l4 + GDP.l4 + Employment.l4 + stock_price.l5 + GDP.l5 + Employment.l5 + stock_price.l6 + GDP.l6 + Employment.l6 + stock_price.l7 + GDP.l7 + Employment.l7 + stock_price.l8 + GDP.l8 + Employment.l8 + stock_price.l9 + GDP.l9 + Employment.l9 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
stock_price.l1  0.6177986  0.1140057   5.419 4.61e-07 ***
GDP.l1          0.0415175  0.0139527   2.976 0.003717 ** 
Employment.l1  -0.0069645  0.0020733  -3.359 0.001131 ** 
stock_price.l2  0.3603716  0.1652332   2.181 0.031680 *  
GDP.l2         -0.0157162  0.0211664  -0.743 0.459633    
Employment.l2   0.0048987  0.0033424   1.466 0.146093    
stock_price.l3  0.0177119  0.1607489   0.110 0.912499    
GDP.l3         -0.0009781  0.0212811  -0.046 0.963439    
Employment.l3  -0.0018913  0.0034992  -0.540 0.590135    
stock_price.l4 -0.1568989  0.1711382  -0.917 0.361596    
GDP.l4         -0.0352143  0.0218848  -1.609 0.110953    
Employment.l4   0.0072039  0.0035652   2.021 0.046168 *  
stock_price.l5  0.3383735  0.2044761   1.655 0.101294    
GDP.l5         -0.0156536  0.0222246  -0.704 0.482964    
Employment.l5   0.0016545  0.0036673   0.451 0.652934    
stock_price.l6  0.1416245  0.2112799   0.670 0.504299    
GDP.l6         -0.0184066  0.0221573  -0.831 0.408236    
Employment.l6  -0.0012687  0.0036506  -0.348 0.728965    
stock_price.l7 -0.9691876  0.2444899  -3.964 0.000144 ***
GDP.l7          0.0190303  0.0219980   0.865 0.389190    
Employment.l7  -0.0017353  0.0035712  -0.486 0.628163    
stock_price.l8  1.0643895  0.2599676   4.094 8.96e-05 ***
GDP.l8          0.0123808  0.0212167   0.584 0.560927    
Employment.l8  -0.0058935  0.0033845  -1.741 0.084893 .  
stock_price.l9 -0.2681893  0.2116088  -1.267 0.208149    
GDP.l9          0.0063637  0.0130395   0.488 0.626663    
Employment.l9   0.0035409  0.0021429   1.652 0.101786    
const          79.8647702 39.9369777   2.000 0.048411 *  
trend           0.9524397  0.5617195   1.696 0.093276 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 8.687 on 94 degrees of freedom
Multiple R-Squared: 0.9959, Adjusted R-squared: 0.9947 
F-statistic:   819 on 28 and 94 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation GDP: 
==================================== 
GDP = stock_price.l1 + GDP.l1 + Employment.l1 + stock_price.l2 + GDP.l2 + Employment.l2 + stock_price.l3 + GDP.l3 + Employment.l3 + stock_price.l4 + GDP.l4 + Employment.l4 + stock_price.l5 + GDP.l5 + Employment.l5 + stock_price.l6 + GDP.l6 + Employment.l6 + stock_price.l7 + GDP.l7 + Employment.l7 + stock_price.l8 + GDP.l8 + Employment.l8 + stock_price.l9 + GDP.l9 + Employment.l9 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
stock_price.l1 -5.605e+00  1.777e+00  -3.154  0.00217 ** 
GDP.l1          1.818e+00  2.175e-01   8.360 5.58e-13 ***
Employment.l1  -1.497e-01  3.232e-02  -4.631 1.17e-05 ***
stock_price.l2  1.352e+01  2.576e+00   5.250 9.43e-07 ***
GDP.l2         -7.098e-01  3.300e-01  -2.151  0.03403 *  
Employment.l2   1.262e-01  5.211e-02   2.422  0.01734 *  
stock_price.l3 -1.116e+00  2.506e+00  -0.445  0.65722    
GDP.l3         -2.534e-01  3.318e-01  -0.764  0.44683    
Employment.l3   3.585e-02  5.455e-02   0.657  0.51262    
stock_price.l4  1.673e+00  2.668e+00   0.627  0.53208    
GDP.l4         -8.506e-02  3.412e-01  -0.249  0.80365    
Employment.l4   1.384e-02  5.558e-02   0.249  0.80384    
stock_price.l5 -7.495e-01  3.188e+00  -0.235  0.81462    
GDP.l5          1.171e-01  3.465e-01   0.338  0.73604    
Employment.l5  -2.497e-02  5.717e-02  -0.437  0.66327    
stock_price.l6 -1.389e+01  3.294e+00  -4.216 5.71e-05 ***
GDP.l6          2.705e-02  3.454e-01   0.078  0.93775    
Employment.l6  -9.452e-03  5.691e-02  -0.166  0.86846    
stock_price.l7 -1.613e+00  3.812e+00  -0.423  0.67319    
GDP.l7         -2.916e-01  3.429e-01  -0.850  0.39727    
Employment.l7   7.971e-02  5.567e-02   1.432  0.15551    
stock_price.l8  7.701e+00  4.053e+00   1.900  0.06049 .  
GDP.l8          9.947e-02  3.308e-01   0.301  0.76428    
Employment.l8  -1.132e-01  5.276e-02  -2.144  0.03457 *  
stock_price.l9  1.073e+00  3.299e+00   0.325  0.74571    
GDP.l9          1.156e-01  2.033e-01   0.569  0.57100    
Employment.l9   3.477e-02  3.341e-02   1.041  0.30064    
const           1.603e+03  6.226e+02   2.575  0.01159 *  
trend           2.134e+01  8.757e+00   2.437  0.01669 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 135.4 on 94 degrees of freedom
Multiple R-Squared: 0.9995, Adjusted R-squared: 0.9993 
F-statistic:  6211 on 28 and 94 DF,  p-value: &lt; 2.2e-16 


Estimation results for equation Employment: 
=========================================== 
Employment = stock_price.l1 + GDP.l1 + Employment.l1 + stock_price.l2 + GDP.l2 + Employment.l2 + stock_price.l3 + GDP.l3 + Employment.l3 + stock_price.l4 + GDP.l4 + Employment.l4 + stock_price.l5 + GDP.l5 + Employment.l5 + stock_price.l6 + GDP.l6 + Employment.l6 + stock_price.l7 + GDP.l7 + Employment.l7 + stock_price.l8 + GDP.l8 + Employment.l8 + stock_price.l9 + GDP.l9 + Employment.l9 + const + trend 

                 Estimate Std. Error t value Pr(&gt;|t|)    
stock_price.l1 -6.801e+01  1.216e+01  -5.595 2.17e-07 ***
GDP.l1          6.439e+00  1.488e+00   4.328 3.75e-05 ***
Employment.l1   1.372e-01  2.211e-01   0.621  0.53643    
stock_price.l2  1.137e+02  1.762e+01   6.453 4.74e-09 ***
GDP.l2         -4.116e+00  2.257e+00  -1.824  0.07136 .  
Employment.l2   5.335e-01  3.564e-01   1.497  0.13778    
stock_price.l3 -4.159e+00  1.714e+01  -0.243  0.80882    
GDP.l3         -3.838e+00  2.269e+00  -1.691  0.09408 .  
Employment.l3   5.003e-01  3.731e-01   1.341  0.18318    
stock_price.l4  1.066e+01  1.825e+01   0.584  0.56038    
GDP.l4         -6.501e-02  2.334e+00  -0.028  0.97783    
Employment.l4   1.168e-01  3.802e-01   0.307  0.75925    
stock_price.l5  2.259e+01  2.180e+01   1.036  0.30277    
GDP.l5          8.889e-01  2.370e+00   0.375  0.70845    
Employment.l5  -2.821e-01  3.911e-01  -0.721  0.47245    
stock_price.l6 -1.130e+02  2.253e+01  -5.017 2.48e-06 ***
GDP.l6         -1.567e+00  2.363e+00  -0.663  0.50891    
Employment.l6   2.161e-01  3.893e-01   0.555  0.58019    
stock_price.l7 -2.070e+01  2.607e+01  -0.794  0.42930    
GDP.l7         -1.096e+00  2.346e+00  -0.467  0.64133    
Employment.l7   4.753e-01  3.808e-01   1.248  0.21512    
stock_price.l8  8.864e+01  2.772e+01   3.198  0.00189 ** 
GDP.l8          1.933e+00  2.262e+00   0.854  0.39515    
Employment.l8  -1.204e+00  3.609e-01  -3.336  0.00122 ** 
stock_price.l9 -3.272e+01  2.256e+01  -1.450  0.15042    
GDP.l9          8.076e-01  1.390e+00   0.581  0.56273    
Employment.l9   4.222e-01  2.285e-01   1.848  0.06777 .  
const           1.262e+04  4.259e+03   2.963  0.00386 ** 
trend           9.703e+01  5.990e+01   1.620  0.10859    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Residual standard error: 926.4 on 94 degrees of freedom
Multiple R-Squared: 0.9945, Adjusted R-squared: 0.9928 
F-statistic: 603.2 on 28 and 94 DF,  p-value: &lt; 2.2e-16 



Covariance matrix of residuals:
            stock_price      GDP Employment
stock_price       75.47    290.5       2750
GDP              290.52  18342.3     112144
Employment      2749.66 112143.8     858125

Correlation matrix of residuals:
            stock_price    GDP Employment
stock_price      1.0000 0.2469     0.3417
GDP              0.2469 1.0000     0.8939
Employment       0.3417 0.8939     1.0000</code></pre>
</div>
</div>
</section>
<section id="step-4-using-cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="step-4-using-cross-validation">Step 4: Using Cross Validation</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">length</span>(dd<span class="sc">$</span>stock_price)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>k<span class="ot">=</span><span class="dv">39</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#n-k=92; 92/4=23;</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>rmse1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="dv">96</span>,<span class="dv">3</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>rmse2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="dv">96</span>,<span class="dv">3</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>rmse3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="dv">23</span>,<span class="dv">4</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>year<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert data frame to time series object</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>ts_obj <span class="ot">&lt;-</span> <span class="fu">ts</span>(dd[, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)], <span class="at">star=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"1990-01-01"</span>,<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),<span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span> <span class="fu">tsp</span>(ts_obj )[<span class="dv">1</span>]<span class="sc">+</span>(k<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">4</span> </span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">23</span>)</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  xtrain <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_obj, <span class="at">end=</span>st <span class="sc">+</span> i<span class="dv">-1</span>)</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  xtest <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_obj, <span class="at">start=</span>st <span class="sc">+</span> (i<span class="dv">-1</span>) <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">end=</span>st <span class="sc">+</span> i)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">VAR</span>(ts_obj, <span class="at">p=</span><span class="dv">5</span>, <span class="at">type=</span><span class="st">'both'</span>)</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">n.ahead =</span> <span class="dv">4</span>)</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>  fgdp<span class="ot">&lt;-</span>fcast<span class="sc">$</span>fcst<span class="sc">$</span>GDP</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  femp<span class="ot">&lt;-</span>fcast<span class="sc">$</span>fcst<span class="sc">$</span>Employment</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  fsp<span class="ot">&lt;-</span>fcast<span class="sc">$</span>fcst<span class="sc">$</span>stock_price</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  ff<span class="ot">&lt;-</span><span class="fu">data.frame</span>(fsp[,<span class="dv">1</span>],fgdp[,<span class="dv">1</span>],femp[,<span class="dv">1</span>])</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>  year<span class="ot">&lt;-</span>st <span class="sc">+</span> (i<span class="dv">-1</span>) <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  ff<span class="ot">&lt;-</span><span class="fu">ts</span>(ff,<span class="at">start=</span><span class="fu">c</span>(year,<span class="dv">1</span>),<span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">=</span> <span class="dv">4</span><span class="sc">*</span>i<span class="dv">-3</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span> <span class="dv">4</span><span class="sc">*</span>i</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  rmse1[<span class="fu">c</span>(a<span class="sc">:</span>b),]  <span class="ot">&lt;-</span><span class="fu">sqrt</span>((ff<span class="sc">-</span>xtest)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>  fit2 <span class="ot">&lt;-</span> <span class="fu">VAR</span>(ts_obj, <span class="at">p=</span><span class="dv">9</span>, <span class="at">type=</span><span class="st">'both'</span>)</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>  fcast2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">n.ahead =</span> <span class="dv">4</span>)</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>  fgdp<span class="ot">&lt;-</span>fcast2<span class="sc">$</span>fcst<span class="sc">$</span>GDP</span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>  femp<span class="ot">&lt;-</span>fcast2<span class="sc">$</span>fcst<span class="sc">$</span>Employment</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>  fsp<span class="ot">&lt;-</span>fcast2<span class="sc">$</span>fcst<span class="sc">$</span>stock_price</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>  ff2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(fsp[,<span class="dv">1</span>],fgdp[,<span class="dv">1</span>],femp[,<span class="dv">1</span>])</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>  year<span class="ot">&lt;-</span>st <span class="sc">+</span> (i<span class="dv">-1</span>) <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>  ff2<span class="ot">&lt;-</span><span class="fu">ts</span>(ff2,<span class="at">start=</span><span class="fu">c</span>(year,<span class="dv">1</span>),<span class="at">frequency =</span> <span class="dv">4</span>)</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">=</span> <span class="dv">4</span><span class="sc">*</span>i<span class="dv">-3</span></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span> <span class="dv">4</span><span class="sc">*</span>i</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>  rmse2[<span class="fu">c</span>(a<span class="sc">:</span>b),]  <span class="ot">&lt;-</span><span class="fu">sqrt</span>((ff2<span class="sc">-</span>xtest)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a>yr <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1999</span><span class="sc">:</span><span class="dv">2022</span>),<span class="at">each =</span><span class="dv">4</span>)</span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>qr <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"Q"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),<span class="dv">24</span>)</span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a>rmse1 <span class="ot">=</span> <span class="fu">data.frame</span>(yr,qr,rmse1)</span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rmse1) <span class="ot">=</span><span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Quater"</span>,<span class="st">"Stock_Price"</span>,<span class="st">"GDP"</span>,<span class="st">"Employment"</span>)</span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a>rmse2 <span class="ot">=</span> <span class="fu">data.frame</span>(yr,qr,rmse2)</span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rmse2) <span class="ot">=</span><span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Quater"</span>,<span class="st">"Stock_Price"</span>,<span class="st">"GDP"</span>,<span class="st">"Employment"</span>)</span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> rmse1, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Stock_Price),<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> rmse2, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Stock_Price),<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"CV RMSE for Stock_Price"</span>,</span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"RMSE"</span>,</span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">colour=</span><span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">"Fit"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> rmse1, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> GDP),<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> rmse2, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> GDP),<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"CV RMSE for GDP"</span>,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"RMSE"</span>,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">colour=</span><span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">"Fit"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values (`geom_line()`).
Removed 4 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> rmse1, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Employment),<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> rmse2, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Employment),<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"CV RMSE for Employment"</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"RMSE"</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">colour=</span><span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">"Fit"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values (`geom_line()`).
Removed 4 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>fit 1 is better</p>
</section>
<section id="step-5-forecast" class="level3">
<h3 class="anchored" data-anchor-id="step-5-forecast">Step 5: Forecast</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>forecasts <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">VAR</span>(dd[, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)], <span class="at">p=</span><span class="dv">5</span>, <span class="at">type=</span><span class="st">'both'</span>))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the iterated forecasts</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forecasts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="arimax_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>